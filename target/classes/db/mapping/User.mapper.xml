<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.bambooframework.dao.IUserDao">
	<resultMap type="org.bambooframework.entity.User" id="userMap">
		<result column="ID_" jdbcType="INTEGER" property="id"/>
		<result column="ORG_ID_" jdbcType="VARCHAR" property="orgId"/>
		<result column="CODE_" jdbcType="VARCHAR" property="code"/>
		<result column="NAME_" jdbcType="VARCHAR" property="name"/>
		<result column="SEX_" jdbcType="VARCHAR" property="sex"/>
		<result column="EMAIL_" jdbcType="VARCHAR" property="email"/>
		<result column="TELEPHONE_" jdbcType="VARCHAR" property="telephone"/>
		<result column="CELLPHONE_" jdbcType="VARCHAR" property="cellphone"/>
		<result column="STATUS_" jdbcType="VARCHAR" property="status"/>
		<result column="LOGIN_NAME_" jdbcType="VARCHAR" property="loginName"/>
		<result column="PASSWORD_" jdbcType="VARCHAR" property="password"/>
		<result column="ORG_NAME_" jdbcType="VARCHAR" property="orgName"/>
	</resultMap>

	<insert id="insert" parameterType="org.bambooframework.entity.User" keyProperty="id">
		insert into T_USER(ID_,ORG_ID_,CODE_,NAME_,SEX_,EMAIL_,TELEPHONE_,
			CELLPHONE_,STATUS_,LOGIN_NAME_,PASSWORD_)
		values(
			#{id,jdbcType=INTEGER},
			#{orgId,jdbcType=VARCHAR},
			#{code,jdbcType=VARCHAR},
			#{name,jdbcType=VARCHAR},
			#{sex,jdbcType=VARCHAR},
			#{email,jdbcType=VARCHAR},
			#{telephone,jdbcType=VARCHAR},
			#{cellphone,jdbcType=VARCHAR},
			#{status,jdbcType=VARCHAR},
			#{loginName,jdbcType=VARCHAR},
			#{password,jdbcType=VARCHAR}
		)
	</insert>
	
	<update id="update" parameterType="org.bambooframework.entity.User" >
		update T_USER set 
			ORG_ID_ = #{orgId,jdbcType=VARCHAR},
			CODE_ = #{code,jdbcType=VARCHAR},
			NAME_ = #{name,jdbcType=VARCHAR},
			SEX_ = #{sex,jdbcType=VARCHAR},
			EMAIL_ = #{email,jdbcType=VARCHAR},
			TELEPHONE_ = #{telephone,jdbcType=VARCHAR},
			CELLPHONE_ = #{cellphone,jdbcType=VARCHAR},
			STATUS_ = #{status,jdbcType=VARCHAR},
			LOGIN_NAME_ = #{loginName,jdbcType=VARCHAR}
		where ID_ = #{id}
	</update>
	
	<update id="delete">
		update T_USER set STATUS_ = '1' where ID_ = #{id}
	</update>
	
	<select id="get" parameterType="int" resultMap="userMap">
		select * from T_USER where ID_ = #{id}
	</select>
	
	<select id="find" parameterType="map" resultMap="userMap">
		select u.*,(select  NAME_ from T_ORG where ID_ = u.ORG_ID_) ORG_NAME_ from T_USER u
		<where>
			<if test="orgId != null">
				and ORG_ID_ = #{orgId}
			</if>
			<if test="name != null">
				<bind name="namelike" value="name + '%'" />
			   and NAME_ like #{namelike}
			</if>
			<if test="codeOrName != null">
				<bind name="codeOrNamelike" value="codeOrName + '%'" />
			   and (NAME_ like #{codeOrNamelike} or CODE_ like #{codeOrNamelike})
			</if>
		</where>
	</select>
	
	<select id="selectUsers" parameterType="map" resultMap="userMap">
		select * from T_USER
		<where>
			<if test="orgId != null">
				ORG_ID_ = #{orgId}
			</if>
			<if test="name != null">
				<bind name="namelike" value="name + '%'" />
				NAME_ like #{namelike}
			</if>
			<if test="codeOrName != null">
				<bind name="codeOrNamelike" value="codeOrName + '%'" />
				NAME_ like #{codeOrNamelike}
			</if>
		</where>
	</select>
	
	<select id="getUserByLoginName" parameterType="string" resultMap="userMap">
		select * from T_USER where LOGIN_NAME_=#{login_name}
	</select>
</mapper>